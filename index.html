<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coli Sphericus</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ü¶†</text></svg>">
    <link rel="stylesheet" type="text/css" href="./web/style.css">
</head>
<body>
    <div id="control-panel">
        <button
            class="control important-control"
            onclick="startDrawing()">
                –ú–∞–ª—é–π!
        </button>

        <button class="control" onclick="stopDrawing()">–°—Ç–æ–ø!</button>

        <button class="control" onclick="clearDrawing()">–û—á–∏—Å—Ç–∏—Ç–∏</button>

        <div class="control">
            <span>—à–≤–∏–¥–∫—ñ—Å—Ç—å:</span>
            <input class="control" id="speed" type="number" value="1"/>
            <span>–º–º/—Å</span>
        </div>

        <div class="control">
            <span>—á–∞—Å:</span>
            <input class="control" id="time" type="number" value="15"/>
            <span>—Ö–≤</span>
        </div>

        <button class="control" onclick="toggleParams()">–û–ø—Ü—ñ—ó ‚ñº</button>
        <div id="paramList" class="param-list-wrapper hidden">
            <ul class="param-list">
                <li class="param"><input type="checkbox" id="param_bounded">
                    –ù–µ –≤–∏—Ö–æ–¥–∏—Ç–∏ –∑–∞ –º–µ–∂—ñ
                </input></li>
                <li class="param"><input type="checkbox" id="param_wait">
                    –î–æ—á–µ–∫–∞—Ç–∏—Å—è –∑–∞–∫—ñ–Ω—á–µ–Ω–Ω—è —Ä–æ—Å—Ç—É –∫–æ–ª–æ–Ω—ñ–π
                </input></li>
                <li class="param"><input type="checkbox" id="param_hungry">
                    –ì–æ–ª–æ–¥–Ω—ñ –∫–æ–ª–æ–Ω—ñ—ó
                </input></li>
                <li class="param">
                    –ì–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ –¥–∞–Ω—ñ:
                </li>
                <li class="param"><input type="checkbox" id="param_gen_St">
                    S<sub>–∑–∞–≥–∞–ª—å–Ω–∞</sub>(t)
                </input></li>
                <li class="param"><input type="checkbox" id="param_gen_Nt">
                    N<sub>–∞–∫—Ç–∏–≤–Ω–∏—Ö</sub>(t)
                </input></li>
                <li class="param"><input type="checkbox" id="param_gen_tt">
                    t&nbsp;<sub>–∂–∏—Ç—Ç—è –∫–æ–ª–æ–Ω—ñ–π</sub>(t)
                </input></li>
            </ul>
        </div>
    </div>

    <main>
        <canvas id="canvas" width="1000" height="1000">
            HTMl5 not supported.
        </canvas>
    </main>

    <script>
        function toggleParams() {
            document.getElementById('paramList').classList.toggle('hidden');
        }
    </script>

    <script type="module">
        import {default as init_wasm, CircleDrawer} from './wasm/wasm.js';
        
        var drawer;
        
        async function load_wasm() {
            await init_wasm();
            drawer = new CircleDrawer();
        }
        load_wasm();
        
        function step() {
            drawer.draw();
            if (drawer.is_finished())
                window.stopDrawing();
        }
        
        function isChecked(checkboxId) {
            return document.getElementById(checkboxId).checked;
        }

        function getNum(inputId) {
            return Number.parseFloat(document.getElementById(inputId).value);
        }

        window.drawingIntervalObject = null;
        window.startDrawing = function() {
            drawer.set_speed(getNum('speed')); 
            drawer.set_time(getNum('time') * 60); // Mins -> seconds
            drawer.set_bounded(isChecked('param_bounded'));
            drawer.set_should_wait_until_end(isChecked('param_wait'));
            if (window.drawingIntervalObject === null)
                window.drawingIntervalObject = setInterval(step, 100);
        };

        window.stopDrawing = function() {
            if (window.drawingIntervalObject !== null) {
                clearInterval(window.drawingIntervalObject);
                window.drawingIntervalObject = null;
            }
        };

        window.clearDrawing = function() {
            if (confirm("–¢–æ—á–Ω–æ –æ—á–∏—Å—Ç–∏—Ç–∏?"))
                drawer.clear();
        }
    </script>
</body>
</html>